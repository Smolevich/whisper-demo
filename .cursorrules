# Cursor Rules для проекта Whisper

## Общие правила

- Отвечай на русском языке
- Не выдавай высокоуровневые ответы, твоя задача дать конкретное решение применимое к проекту
- Не давай детальные пояснения, но описывай зачем ты вносишь изменения
- Аккуратно обращайся со старым кодом когда предлагаешь новый код

## Архитектура проекта

Проект имеет два независимых режима работы:

1. **REST API (api.py)**: Серверное решение через Docker с WhisperX
2. **Browser (index.html)**: Клиентское решение через Transformers.js и WebAssembly

Эти режимы НЕ интегрированы друг с другом - это отдельные реализации.

## Правила для Browser Mode (index.html)

- Используй Transformers.js версии 2.17.1 из CDN
- Модели Xenova/whisper-* из Hugging Face
- callback_function может не работать для ASR pipeline - используй симуляцию прогресса через setInterval
- Всегда добавляй таймауты для транскрипции (10 минут по умолчанию)
- Добавляй heartbeat механизм для отслеживания зависаний
- Обрабатывай глобальные ошибки для предотвращения белого экрана
- Предупреждай пользователя о низком качестве base модели для длинных файлов
- Модели кэшируются в браузере после первой загрузки

## Правила для REST API Mode (api.py)

- Используй FastAPI с uvicorn
- Автоматически определяй GPU через nvidia-smi или CUDA переменные
- Используй float16 для GPU, float32 для CPU
- Очищай временные файлы после обработки
- WhisperX вызывается через subprocess, не как библиотека

## Обработка ошибок

- Всегда добавляй try-catch блоки с информативными сообщениями
- Предотвращай белый экран через глобальные обработчики ошибок
- Восстанавливай состояние интерфейса при ошибках
- Показывай рекомендации пользователю при ошибках

## Модели Whisper

- tiny: быстрая, низкое качество
- base: баланс скорости/качества (рекомендуется для браузера)
- small: хорошее качество, работает в браузере
- medium: высокое качество, медленно в браузере
- large: только для Docker + GPU

## Git коммиты

- Пиши коммиты на русском языке
- Описывай конкретные изменения, не общие фразы
- Группируй связанные изменения в один коммит

## Тестирование

- Для браузера: проверяй в реальном браузере через GitHub Pages
- Для API: используй curl или документацию на /docs
- Тестируй с разными размерами файлов и моделями

